{"version":3,"file":"index.js","sources":["../src/ModalProvider.tsx","../src/useModal.ts"],"sourcesContent":["import * as React from \"react\";\nimport {\n  ComponentType,\n  createContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\n\n// A Modal object stores information about a modal being shown\nexport interface ModalObject<Data = any, Response = any> {\n  resolve: (data: Response) => void;\n  reject: (reason?: any) => void;\n  data?: Data;\n  component: ComponentType<Modal<Data, Response>>;\n  canClose: boolean;\n}\n\nexport interface Modal<Data, Response = unknown> {\n  data: Data;\n  submit: (res: Response) => void;\n  cancel: () => void;\n  isClosing?: boolean;\n}\n\ninterface contextState {\n  modal?: ModalState;\n  setModal: (obj: ModalObject) => void;\n  closeModal: (data?: unknown) => void;\n}\n\nexport interface ModalProviderProps {\n  // Classnames to pass to the modal background component\n  backgroundClassName?: string | ((closed?: boolean) => string);\n\n  // will instead wait for the transitioned event to fire before closing\n  animated?: boolean;\n\n  // background opacity - defaults to 50%\n  backgroundOpacity?: number;\n}\n\nexport const ModalContext = createContext<contextState>({\n  setModal: () => {},\n  closeModal: () => {},\n});\n\nconst ChildWrapper = React.memo(({ children }) => <>{children}</>);\n\ninterface ModalState {\n  modal?: ModalObject;\n  isClosing?: boolean;\n}\n\nexport const ModalProvider: React.FC<ModalProviderProps> = ({\n  children,\n  animated,\n  backgroundClassName: baseClassName = animated\n    ? (isClosing) =>\n        `async-modals__bg-base async-modals__${isClosing ? \"closing\" : \"open\"}`\n    : \"async-modals__bg-base async-modals__open\",\n}) => {\n  const [state, setState] = useState<ModalState>({});\n\n  const modalContainer = useRef<HTMLDivElement>(null);\n\n  // Close the modal, optionally passing in some data\n  const closeModal = (data?: unknown) => {\n    if (animated) {\n      // If exit delay is set then dont unmount until timer is up\n      setState((s) => ({\n        ...s,\n        isClosing: true,\n      }));\n\n      const listener = () => {\n        state.modal?.resolve(data);\n        setState({});\n      };\n\n      modalContainer.current?.addEventListener(\"transitionend\", listener);\n      modalContainer.current?.addEventListener(\"webkitTransitionEnd\", listener);\n      modalContainer.current?.addEventListener(\"animationend\", listener);\n      modalContainer.current?.addEventListener(\"webkitAnimationEnd\", listener);\n      \n    } else {\n      state.modal?.resolve(data);\n      setState({});\n    }\n  };\n\n  // Cleanup hook for animation timer\n  useEffect(() => {\n    //listener to prevent navigation and instead close the modal\n    const listener = (e: any) => {\n      if (e.state?.modal !== true) {\n        closeModal();\n      }\n    };\n\n    window.addEventListener(\"popstate\", listener);\n\n    return () => {\n      window.removeEventListener(\"popstate\", listener);\n    };\n  }, []);\n\n  const context: contextState = {\n    setModal: (obj) => {\n      history.replaceState({ modal: false }, \"\");\n      history.pushState({ modal: true }, \"\");\n      setState((s) => ({\n        ...s,\n        modal: obj,\n      }));\n    },\n    modal: state,\n    closeModal: (data?: unknown) => {\n      closeModal(data);\n    },\n  };\n\n  return (\n    <ModalContext.Provider value={context}>\n      <ChildWrapper>{children}</ChildWrapper>\n      {state.modal && (\n        <div\n          className={\n            typeof baseClassName === \"function\"\n              ? baseClassName(state.isClosing)\n              : baseClassName\n          }\n          id=\"modal-back\"\n          onMouseDown={(e) => {\n            if (\n              state.modal?.canClose &&\n              (e.target as any)?.id === \"modal-back\"\n            ) {\n              closeModal();\n            }\n          }}\n          ref={modalContainer}\n        >\n          <state.modal.component\n            data={state.modal.data}\n            submit={(data?: unknown) => closeModal(data)}\n            cancel={() => closeModal()}\n            isClosing={state.isClosing}\n          />\n        </div>\n      )}\n    </ModalContext.Provider>\n  );\n};\n","import { ComponentType, useContext } from 'react';\nimport { Modal, ModalContext, ModalObject, } from './ModalProvider';\n\n//Options the user can specify\ninterface options<T> extends settings{\n  /**\n   * Data that will be accessible in the component as props\n   */\n  data?: T;\n\n}\n\ninterface settings {\n  /**\n   * Allow the user to close the modal by clicking on the background.\n   * By default this is set to true\n   */\n   canClose?: boolean;\n}\n\n// Overloads\nexport function useModal(modalComponent?: undefined, modalOptions?: settings): {\n  show: <Data, Response>(component: ComponentType<Modal<Data, Response>>, options?: options<Data>) => Promise<Response | undefined>;\n  close: () => void;\n};\nexport function useModal<Data,Response>(modalComponent: ComponentType<Modal<Data, Response>>, modalOptions?: options<Data>): {\n  show: (options?: options<Data>) => Promise<Response | undefined>;\n  close: () => void;\n};\n\nexport function useModal<Data,Response>(modalComponent?: ComponentType<Modal<Data, Response>>, modalOptions: options<Data> = {}): any {\n  const { setModal, closeModal } = useContext(ModalContext);\n\n  const show = (component: ComponentType<Modal<Data, Response>>) => async ( options: options<Data> = modalOptions): Promise<Response | undefined> =>\n  new Promise((resolve, reject) => {\n    const obj: ModalObject<Data, Response> = {\n      resolve,\n      reject,\n      data: options.data,\n      component,\n      canClose: Boolean(options.canClose),\n    };\n    setModal(obj);\n  })\n\n  return {\n    show: modalComponent ? show(modalComponent) : (component: ComponentType<Modal<Data, Response>>, options: options<Data> = modalOptions) => show(component)(options),\n    close: () => closeModal()\n  };\n};"],"names":["createContext","React","useState","useRef","useEffect","useContext"],"mappings":"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"}